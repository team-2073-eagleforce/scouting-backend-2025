{% extends 'index.html' %}
{% load static %}

{% block Title %} Team {{ team_number }}{% endblock %}

{% block Content %}
<h2>Team {{ team_number }}</h2>
<input type="hidden" id="team_number" value="{{ team_number }}">

{% if team.pit_scout_status == True %}
<div class="row">
    <div class="col-8">
        <span><b>Drivetrain: </b>{{ team.drivetrain }}</span> <br> <br>
        <span><b>Length x Width (Bumper): </b>{{ team.length }} x {{ team.width }}</span> <br> <br>
        <span><b>Weight: </b>{{ team.weight }}</span> <br> <br>
        <span><b>Intake Design: </b>{{ team.intake_design }}</span> <br> <br>
        <span><b>Under Shallow Coral: </b>{{ team.under_shallow_coral }}</span> <br> <br>
        <span><b>Ball Remover?: </b>{{ team.removeable }}</span> <br> <br>
        <span><b>Intake Locations: </b>{{ team.intake_locations }}</span> <br> <br>
        <span><b>Scoring Locations: </b>{{ team.scoring_locations }}</span> <br> <br>
        <span><b>Cage Positions: </b>{{ team.cage_positions }}</span> <br> <br>
        <span><b>Auto Positions: </b>{{ team.auto_positions }}</span> <br> <br>
        <span><b>Auto Leave: </b>{{ team.auto_leave }}</span> <br> <br>
        <span><b>Auto Total: </b>{{ team.auto_total_notes }}</span> <br> <br>
        <span><b>Auto Coral: </b>{{ team.auto_coral_notes }}</span> <br> <br>
        <span><b>Additional Info: </b> {{ team.additional_info }}</span> <br> <br>
        <a href="{% url 'pit_scouting' team_number %}?comp={{ request.GET.comp }}">Update Info</a>
    </div>
    <div class="col-4">
        {% if team.robot_picture %}
        <img src="{{ team.robot_picture }}" alt="Robot Picture" class="img-thumbnail">
        {% else %}
        <p>No robot picture available.</p>
        {% endif %}
    </div>
</div>
{% else %}
<a href="{% url 'pit_scouting' team_number %}?comp={{ comp_code }}">Pit Scout</a>
{% endif %}

<!-- Match Data Table -->
<div class="table-responsive">
    <table id="match_data" class="table table-bordered">
        <thead>
            <tr>
                <th>Match</th>
                <th>Leave</th>
                <th>A-L1</th>
                <th>A-L2</th>
                <th>A-L3</th>
                <th>A-L4</th>
                <th>A-Net</th>
                <th>A-Proc</th>
                <th>A-Rem</th>
                <th>T-L1</th>
                <th>T-L2</th>
                <th>T-L3</th>
                <th>T-L4</th>
                <th>T-Net</th>
                <th>T-Proc</th>
                <th>T-Rem</th>
                <th>Climb</th>
                <th>Driver</th>
                <th>Defense</th>
                <th>Start Position</th>
                <th>Auto Path</th>
                <th id="comments_column">Comments</th>
                <th>Scout Name</th>
            </tr>
        </thead>
        <tbody>
            {% for match in all_team_match_data %}
            <tr>
                <td>{{ match.match_number }}{% if match.quantifier %}-{{ match.quantifier }}{% endif %}</td>
                <td>{{ match.auto_leave }}</td>
                <td>{{ match.auto_L1 }}</td>
                <td>{{ match.auto_L2 }}</td>
                <td>{{ match.auto_L3 }}</td>
                <td>{{ match.auto_L4 }}</td>
                <td>{{ match.auto_net }}</td>
                <td>{{ match.auto_processor }}</td>
                <td>{{ match.auto_removed }}</td>
                <td>{{ match.teleL1 }}</td>
                <td>{{ match.teleL2 }}</td>
                <td>{{ match.teleL3 }}</td>
                <td>{{ match.teleL4 }}</td>
                <td>{{ match.telenet }}</td>
                <td>{{ match.teleProcessor }}</td>
                <td>{{ match.teleRemoved }}</td>
                <td>{{ match.climb }}</td>
                <td>{{ match.driver_ranking }}</td>
                <td>{{ match.defense_ranking }}</td>
                <td>{{ match.start_pos }}</td>
                <td>{{ match.auto_path|default:"" }}</td>
                <td>{{ match.comment }}</td>
                <td>{{ match.scout_name }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="23" class="text-center">No match data available</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Replay System Section -->
<h3>Auto Path Replay</h3>
<div class="replay-container">
    <select id="pathSelector" class="form-control mb-2">
        <option value="">Select a match to replay</option>
        {% for match in all_team_match_data %}
            {% if match.auto_path %}
                <option value="{{ match.match_number }}">
                    Match {{ match.match_number }}{% if match.quantifier %}-{{ match.quantifier }}{% endif %}
                </option>
            {% endif %}
        {% endfor %}
    </select>    

    <div class="replay-canvas-container">
        <img src="{% static 'images/replays.png' %}" alt="Auto Map" style="width: 100%; max-width: 800px;">
        <canvas id="replayCanvas" style="position: absolute; top: 0; left: 0; width: 100%; max-width: 800px; height: auto;"></canvas>
    </div>

    <div class="controls mt-2">
        <button id="playButton" class="btn btn-primary">Play</button>
        <button id="pauseButton" class="btn btn-secondary">Pause</button>
        <button id="resetButton" class="btn btn-warning">Reset</button>
    </div>
</div>

<!-- Include the external JavaScript file -->
<script src="{% static 'team/replay_system.js' %}"></script>

<style>
.replay-container {
    max-width: 800px;
    margin: 0 auto;
}

.replay-canvas-container {
    position: relative;
}

.controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 10px;
}
</style>

{% endblock %}
