/*! For license information please see scanner.8ceee289828a00a74b75.js.LICENSE.txt */
(()=>{"use strict";function t(){var n,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(t,o,i,a){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return e(l,"_invoke",function(t,e,o){var i,a,c,s=0,l=o||[],f=!1,p={p:0,n:0,v:n,a:h,f:h.bind(n,4),d:function(t,e){return i=t,a=0,c=n,p.n=e,u}};function h(t,e){for(a=t,c=e,r=0;!f&&s&&!o&&r<l.length;r++){var o,i=l[r],h=p.p,y=i[2];t>3?(o=y===e)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=n):i[0]<=h&&((o=t<2&&h<i[1])?(a=0,p.v=e,p.n=i[1]):h<y&&(o=t<3||i[0]>e||e>y)&&(i[4]=t,i[5]=e,p.n=y,a=0))}if(o||t>1)return u;throw f=!0,e}return function(o,l,y){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&h(l,y),a=l,c=y;(r=a<2?n:c)||!f;){i||(a?a<3?(a>1&&(p.n=-1),h(a,c)):p.n=c:p.v=c);try{if(s=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=n}else if((r=(f=p.n<0)?c:t.call(e,p))!==u)break}catch(t){i=n,a=1,c=t}finally{s=1}}return{value:r,done:f}}}(t,i,a),!0),l}var u={};function s(){}function l(){}function f(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(e(r={},i,function(){return this}),r),h=f.prototype=s.prototype=Object.create(p);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,e(t,a,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=f,e(h,"constructor",f),e(f,"constructor",l),l.displayName="GeneratorFunction",e(f,a,"GeneratorFunction"),e(h),e(h,a,"Generator"),e(h,i,function(){return this}),e(h,"toString",function(){return"[object Generator]"}),(t=function(){return{w:c,m:y}})()}function e(t,n,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}e=function(t,n,r,o){function a(n,r){e(t,n,function(t){return this._invoke(n,r,t)})}n?i?i(t,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):t[n]=r:(a("next",0),a("throw",1),a("return",2))},e(t,n,r,o)}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){i(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function i(t,e,r){return(e=function(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function c(t){a(i,r,o,c,u,"next",t)}function u(t){a(i,r,o,c,u,"throw",t)}c(void 0)})}}function u(t){var e=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),r=0;r<n.length;r++){var o=n[r].trim();if(o.startsWith("".concat(t,"="))){e=decodeURIComponent(o.substring(t.length+1));break}}return e}function s(t){return l.apply(this,arguments)}function l(){return l=c(t().m(function e(r){var i,a,c,s,l,f,p=arguments;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:return a={method:"GET",credentials:"include",mode:"same-origin",headers:o({Accept:"application/json","X-Requested-With":"XMLHttpRequest"},(i=p.length>1&&void 0!==p[1]?p[1]:{}).headers)},i.method&&"GET"!==i.method&&(a.headers["X-CSRFToken"]=u("csrftoken")),i.body&&"object"===n(i.body)&&(a.headers["Content-Type"]="application/json",i.body=JSON.stringify(i.body)),c=o(o({},a),i),t.p=1,t.n=2,fetch(r,c);case 2:if((s=t.v).ok){t.n=4;break}return t.n=3,s.json().catch(function(){return{error:"Unknown error"}});case 3:throw l=t.v,new Error(l.error||"HTTP ".concat(s.status,": ").concat(s.statusText));case 4:return t.a(2,s);case 5:throw t.p=5,f=t.v,console.error("API Request failed:",f),f;case 6:return t.a(2)}},e,null,[[1,5]])})),l.apply(this,arguments)}function f(t,e){return p.apply(this,arguments)}function p(){return(p=c(t().m(function e(n,r){var o;return t().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,s(n,{method:"POST",body:r});case 1:return o=t.v,t.a(2,o.json())}},e)}))).apply(this,arguments)}function h(){navigator.vibrate&&navigator.vibrate(50)}function y(t){var e=document.getElementById(t);return e||console.warn("Element with ID '".concat(t,"' not found")),e}function v(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t)if("function"==typeof n)try{t.addEventListener(e,n,r)}catch(t){console.error("Failed to add ".concat(e," listener:"),t)}else console.warn("Event handler must be a function");else console.warn("Cannot add event listener to null element")}function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function b(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return m(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function h(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],h=p.p,y=i[2];n>3?(o=y===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(c=0,p.v=r,p.n=i[1]):h<y&&(o=n<3||i[0]>r||r>y)&&(i[4]=n,i[5]=r,p.n=y,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,y){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&h(l,y),c=l,u=y;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),h(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(m(e={},r,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,m(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,m(f,"constructor",s),m(s,"constructor",u),u.displayName="GeneratorFunction",m(s,o,"GeneratorFunction"),m(f),m(f,o,"Generator"),m(f,r,function(){return this}),m(f,"toString",function(){return"[object Generator]"}),(b=function(){return{w:i,m:p}})()}function m(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}m=function(t,e,n,r){function i(e,n){m(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},m(t,e,n,r)}function w(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function g(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){w(i,r,o,a,c,"next",t)}function c(t){w(i,r,o,a,c,"throw",t)}a(void 0)})}}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,O(r.key),r)}}function O(t){var e=function(t){if("object"!=d(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==d(e)?e:e+""}var j=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.video=null,this.resultDisplay=null,this.scanner=null,this.prevResult="",this.isInitialized=!1,this.init()},e=[{key:"init",value:(c=g(b().m(function t(){var e,n,r=this;return b().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,this.video=y("qr-video"),this.resultDisplay=y("cam-qr-result"),this.video&&this.resultDisplay){t.n=1;break}return console.error("Required elements not found for QR scanner"),t.a(2);case 1:return t.n=2,this.loadQrScanner();case 2:if(e=t.v){t.n=3;break}return console.error("QrScanner library not available"),t.a(2);case 3:return this.scanner=new e(this.video,function(t){return r.handleScanResult(t)},{highlightScanRegion:!0,highlightCodeOutline:!0}),this.setupEventListeners(),t.n=4,this.startScanner();case 4:this.isInitialized=!0,t.n=6;break;case 5:t.p=5,n=t.v,console.error("Failed to initialize QR scanner:",n);case 6:return t.a(2)}},t,this,[[0,5]])})),function(){return c.apply(this,arguments)})},{key:"loadQrScanner",value:(a=g(b().m(function t(){var e,n;return b().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,"undefined"==typeof QrScanner){t.n=1;break}return t.a(2,QrScanner);case 1:return(e=document.createElement("script")).src="/static/scanner/qr-scanner.min.js",document.head.appendChild(e),t.a(2,new Promise(function(t,n){e.onload=function(){"undefined"!=typeof QrScanner?t(QrScanner):n(new Error("QrScanner not loaded"))},e.onerror=function(){return n(new Error("Failed to load QrScanner"))}}));case 2:return t.p=2,n=t.v,console.error("Error loading QrScanner:",n),t.a(2,null)}},t,null,[[0,2]])})),function(){return a.apply(this,arguments)})},{key:"handleScanResult",value:(i=g(b().m(function t(e){var n,r;return b().w(function(t){for(;;)switch(t.p=t.n){case 0:if((n=e.data)!==this.prevResult&&!n.includes("error")){t.n=1;break}return t.a(2);case 1:return this.prevResult=n,this.displayResult(n),t.p=2,t.n=3,this.sendToServer(n);case 3:h(),t.n=5;break;case 4:t.p=4,r=t.v,console.error("Failed to send scan result to server:",r),this.showError("Failed to process scan result");case 5:return t.a(2)}},t,this,[[2,4]])})),function(t){return i.apply(this,arguments)})},{key:"displayResult",value:function(t){var e=this;this.resultDisplay&&(console.log("Scanned Data:",t),this.resultDisplay.textContent=t,this.resultDisplay.style.color="teal",clearTimeout(this.resultDisplay.highlightTimeout),this.resultDisplay.highlightTimeout=setTimeout(function(){e.resultDisplay.style.color="inherit"},100))}},{key:"sendToServer",value:(o=g(b().m(function t(e){var n,r;return b().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,f("/scanner/",{qr_data:e});case 1:return n=t.v,console.log("Server Response:",n),t.a(2,n);case 2:throw t.p=2,r=t.v,console.error("Error sending to server:",r),r;case 3:return t.a(2)}},t,null,[[0,2]])})),function(t){return o.apply(this,arguments)})},{key:"showError",value:function(t){this.resultDisplay&&(this.resultDisplay.textContent=t,this.resultDisplay.style.color="red")}},{key:"setupEventListeners",value:function(){var t=this,e=y("start-button"),n=y("stop-button");e&&v(e,"click",function(){return t.start()}),n&&v(n,"click",function(){return t.stop()})}},{key:"startScanner",value:(r=g(b().m(function t(){var e,n;return b().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.scanner){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,this.scanner.start();case 2:if("undefined"==typeof QrScanner){t.n=4;break}return t.n=3,QrScanner.listCameras(!0);case 3:e=t.v,this.populateCameraOptions(e);case 4:t.n=6;break;case 5:t.p=5,n=t.v,console.error("Failed to start scanner:",n),this.showError("Failed to start camera");case 6:return t.a(2)}},t,this,[[1,5]])})),function(){return r.apply(this,arguments)})},{key:"populateCameraOptions",value:function(t){var e=this,n=y("camera-select");n&&(t.forEach(function(t){var e=document.createElement("option");e.value=t.id,e.text=t.label,n.appendChild(e)}),v(n,"change",function(t){e.scanner&&e.scanner.setCamera(t.target.value)}))}},{key:"start",value:(n=g(b().m(function t(){var e;return b().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.scanner){t.n=4;break}return t.p=1,t.n=2,this.scanner.start();case 2:t.n=4;break;case 3:t.p=3,e=t.v,console.error("Failed to start scanner:",e),this.showError("Failed to start scanning");case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return n.apply(this,arguments)})},{key:"stop",value:function(){this.scanner&&this.scanner.stop()}},{key:"destroy",value:function(){this.scanner&&(this.scanner.stop(),this.scanner.destroy(),this.scanner=null),this.isInitialized=!1}}],e&&S(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i,a,c}();document.addEventListener("DOMContentLoaded",function(){new j})})();
//# sourceMappingURL=scanner.8ceee289828a00a74b75.js.map